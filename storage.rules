rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // Deny all reads and writes by default.
    match /{allPaths=**} {
      allow read, write: if false;
    }

    // Allow users to read and write ONLY within their own designated folder.
    // This rule ensures that a user can only upload/download files (covers, audio)
    // to a path that is explicitly tied to their unique user ID.
    // e.g., /covers/USER_ID_123/my_file.jpg
    match /covers/{userId}/{allPaths=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    match /summaries/{userId}/{allPaths=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
